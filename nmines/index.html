<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEW MINES</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Анимация снега -->
    <div class="snow"></div>

    <!-- Основной контейнер -->
    <div class="main-container">
        <!-- Анимационная надпись -->
        <div class="winner">
            <img class="logo" src="logo.png">
        </div>

        <!-- Контейнер с фоном для сетки -->
        <div class="grid-background">
            <div class="grid"></div>
        </div>

        <!-- Текст под сеткой -->
        <p class="cell-count-label">КОЛ-ВО ЛОВУШЕК</p>

        <!-- Контейнер управления количеством ловушек -->
        <div id="counter-container">
            <button id="minus-btn">
                <img src="./minus.png" alt="Minus">
            </button>
            <span id="trap-count">2</span>
            <button id="plus-btn">
                <img src="./plus.png" alt="Plus">
            </button>
        </div>

        <!-- Кнопка для подсветки -->
        <div class="controls">
            <button id="highlight-btn">Получить сигнал</button>
        </div>
    </div>
    <div class="tab">
        <button class="tablinks games-icon" data-tab="Games" onclick="window.location.href='../index.html'">
            <img src="back.png" alt="Игры">
        </button>
    </div>
    <script src="script.js" defer></script>

<script>
// Скрипт для исправления кнопок "назад"
document.addEventListener('DOMContentLoaded', function() {
    // Функция для перехвата клика и перенаправления на главное меню
    function redirectToMainMenu(e) {
        if (e) e.preventDefault();
        window.location.href = '../index.html';
        return false;
    }

    // Находим все кнопки/ссылки, которые могут вести на GitHub Pages или назад
    const backButtons = document.querySelectorAll(
        'a[href*="github.io"], a[href*="back"], a[href="../index.html"], a[href="../index.html"], a[href="../index.html"], ' +
        'button.back, .back-button, .btn-back, .back, .home-button, .menu-button, ' +
        'a.back, a.home, a.menu, button[data-action="back"], [aria-label="Back"], ' +
        '[aria-label="Home"], [aria-label="Menu"], .header__back, .header-back'
    );
    
    // Изменяем их URL на наше меню
    backButtons.forEach(function(button) {
        button.addEventListener('click', redirectToMainMenu);
        // Также заменяем href атрибут, если это ссылка
        if (button.tagName.toLowerCase() === 'a') {
            button.href = '../index.html';
        }
    });
    
    // Добавляем обработчик для кнопок с обработчиками onclick
    const allButtons = document.querySelectorAll('button, a, div, span');
    allButtons.forEach(function(button) {
        const onclickAttr = button.getAttribute('onclick');
        if (onclickAttr && (
            onclickAttr.includes('back') || 
            onclickAttr.includes('home') || 
            onclickAttr.includes('menu') || 
            onclickAttr.includes('return') || 
            onclickAttr.includes('exit')
        )) {
            button.onclick = redirectToMainMenu;
        }
    });

    // Обработка клавиш навигации
    window.addEventListener('keydown', function(e) {
        // Обработка клавиши Escape (Esc)
        if (e.key === 'Escape') {
            redirectToMainMenu();
        }
    });

    // Перехватываем нажатие на кнопку назад в браузере
    window.addEventListener('popstate', function() {
        redirectToMainMenu();
        // Предотвращаем дальнейшую навигацию назад
        history.pushState(null, document.title, window.location.href);
    });

    // Добавляем запись в историю, чтобы можно было перехватить нажатие кнопки назад
    history.pushState(null, document.title, window.location.href);
});

// Запускаем скрипт сразу и повторно через небольшую задержку, чтобы перехватить динамически добавленные элементы
setTimeout(function() {
    const event = new Event('DOMContentLoaded');
    document.dispatchEvent(event);
}, 1000);
</script>
</body>
</html><script src='../back-fix.js'></script>
